version: "3.9"

services:
  osjs:
    image: osjs/osjs:v3
    container_name: osjs
    restart: unless-stopped
    ports:
      - "8080:8000"
    environment:
      # modo produção
      NODE_ENV: production

      # ativa auth por banco
      OSJS_AUTHENTICATOR: database

      # config do banco
      OSJS_DB_TYPE: mysql
      OSJS_DB_HOST: db
      OSJS_DB_USER: osjs
      OSJS_DB_PASS: osjspass
      OSJS_DB_NAME: osjs

      # caminho do filesystem dos usuários
      OSJS_FS_ROOT: /data

    volumes:
      - ./data:/data

    depends_on:
      - db

  db:
    image: mariadb:10.6
    container_name: osjs-db
    restart: unless-stopped
    environment:
      MYSQL_ROOT_PASSWORD: rootpass
      MYSQL_DATABASE: osjs
      MYSQL_USER: osjs
      MYSQL_PASSWORD: osjspass
    volumes:
      - ./db:/var/lib/mysql
